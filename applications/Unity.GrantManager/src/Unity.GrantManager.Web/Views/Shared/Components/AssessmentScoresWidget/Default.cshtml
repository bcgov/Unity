@using Unity.Flex.Web.Views.Shared.Components.QuestionNumberWidget
@using Unity.Flex.Web.Views.Shared.Components.QuestionTextWidget
@using Unity.Flex.Web.Views.Shared.Components.QuestionYesNoWidget
@using Unity.GrantManager.Web.Views.Shared.Components.AssessmentScoresWidget;
@using Volo.Abp.AspNetCore.Mvc.UI.Layout;
@using Unity.GrantManager.Web.Pages.GrantApplications;
@using Unity.Flex.Scoresheets;

@model AssessmentScoresWidgetViewModel
@{
    Layout = null;
}

@if (Model.Scoresheet != null)
{
    <form id="assessmentScoresheetForm" action="Widgets/AssessmentScoresheet/UpdateAssessmentScoresheet" method="post" enctype="multipart/form-data">
        <abp-input type="hidden" id="AssessmentId" asp-for="@Model.AssessmentId" />
        <div class="container-fluid px-3" id="assessment-scoresheet">
            <div>
                <div>
                    <div class="accordion" id="scoresheetAccordion">
                        @if (Model.Scoresheet.Sections.Any())
                        {
                            var sectionNumber = 1;
                            @foreach (var sec in Model.Scoresheet.Sections.OrderBy(s => s.Order))
                            {
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading-@sec.Id">
                                        <button id="section-button" class="accordion-button collapsed preview-btn" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@sec.Id" aria-expanded="true" aria-controls="collapse-@sec.Id">
                                            @sectionNumber. @sec.Name
                                        </button>
                                    </h2>
                                    <div id="collapse-@sec.Id" class="accordion-collapse collapse" aria-labelledby="heading-@sec.Id">
                                        <div class="accordion-body">
                                            <div class="accordion" id="questionsAccordion-@sec.Id">
                                                @if (sec.Fields != null && sec.Fields.Any())
                                                {
                                                    var questionNumber = 1;
                                                    @foreach (var question in sec.Fields.OrderBy(q => q.Order))
                                                    {
                                                        <div class="accordion-item">
                                                            <h2 class="accordion-header" id="question-heading-@question.Id">
                                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#question-collapse-@question.Id" aria-expanded="true" aria-controls="question-collapse-@question.Id">
                                                                    @sectionNumber.@questionNumber @question.Name
                                                                </button>
                                                            </h2>
                                                            <div id="question-collapse-@question.Id" class="accordion-collapse collapse" aria-labelledby="question-heading-@question.Id" data-bs-parent="#questionsAccordion-@sec.Id">
                                                                <div class="accordion-body">
                                                                    <p>@question.Description</p>
                                                                    
                                                                    @switch (question.Type)
                                                                    {
                                                                        case QuestionType.Number:
                                                                            {
                                                                                @await Component.InvokeAsync(typeof(QuestionNumberWidget), new { QuestionId = question.Id, IsDisabled = Model.IsDisabled(), Answer = Convert.ToDouble(question.Answer) })
                                                                                break;
                                                                            }
                                                                        case QuestionType.YesNo:
                                                                            {
                                                                                @await Component.InvokeAsync(typeof(QuestionYesNoWidget), new { QuestionId = question.Id, IsDisabled = Model.IsDisabled(), Answer = question.Answer })
                                                                                break;
                                                                            }
                                                                        case QuestionType.Text:
                                                                            {
                                                                                @await Component.InvokeAsync(typeof(QuestionTextWidget), new { QuestionId = question.Id, IsDisabled = Model.IsDisabled(), Answer = question.Answer })
                                                                                break;
                                                                            }
                                                                    }
                                                                    
                                                                </div>
                                                            </div>
                                                        </div>
                                                        questionNumber++;
                                                    }
                                                }
                                                else
                                                {
                                                    <p>No questions available.</p>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                sectionNumber++;
                            }
                        }
                        else
                        {
                            <p>No sections available.</p>
                        }
                    </div>
                </div>
                <div class="assessment-sum p-4">
                    <label class="form-label" for="scoresheetSubtotal">Subtotal</label>
                    <input type="number" size="18" class="form-control" disabled="disabled" name="ScoresheetSubtotal" id="scoresheetSubtotal" min="0" max="2147483647" />
                </div>
            </div>
        </div>
    </form>
}
else
{
    <form id="assessmentScoresWidgetForm" action="Widgets/AssessmentScores/UpdateAssessmentScores" method="post" enctype="multipart/form-data">
        <div class="container-fluid px-3">
            <div class="scores-block-wrapper assessment-scores-container">
                <div class="scores-block">
                    <div class="scores-block-left">
                        <div class="scores-block-score">
                            <label class="form-label" for="sectionScore1">Section Score 1</label>
                            <input type="number" class="form-control" disabled="@Model.IsDisabled()" name="SectionScore1" id="sectionScore1" onkeyup="enableSaveButton(this)" onchange="enableSaveButton(this)" min="0" max="99" onkeydown="return positiveIntegersOnly(event);" value="@Model.SectionScore1" />
                        </div>

                        <div class="scores-block-score">
                            <label class="form-label" for="sectionScore3">Section Score 3</label>
                            <input type="number" class="form-control" disabled="@Model.IsDisabled()" name="SectionScore3" id="sectionScore3" onkeyup="enableSaveButton(this)" onchange="enableSaveButton(this)" min="0" max="99" onkeydown="return positiveIntegersOnly(event);" value="@Model.SectionScore3" />
                        </div>
                    </div>

                    <div class="scores-block-right">
                        <div class="scores-block-score">
                            <label class="form-label" for="sectionScore2">Section Score 2</label>
                            <input type="number" class="form-control" disabled="@Model.IsDisabled()" name="SectionScore2" id="sectionScore2" onkeyup="enableSaveButton(this)" onchange="enableSaveButton(this)" min="0" max="99" onkeydown="return positiveIntegersOnly(event);" value="@Model.SectionScore2" />
                        </div>

                        <div class="scores-block-score">
                            <label class="form-label" for="SectionScore4">Section Score 4</label>
                            <input type="number" class="form-control" disabled="@Model.IsDisabled()" name="SectionScore4" id="sectionScore4" onkeyup="enableSaveButton(this)" onchange="enableSaveButton(this)" min="0" max="99" onkeydown="return positiveIntegersOnly(event);" value="@Model.SectionScore4" />
                        </div>
                    </div>
                </div>
                <div class="assessment-sum">
                    <label class="form-label" for="subTotal">Subtotal</label>
                    <input type="number" size="18" class="form-control" disabled="disabled" name="SubTotal" id="subTotal" value="@Model.ScoreTotal()" min="0" max="2147483647" />
                </div>
                <div class="scores-block-save">
                    <abp-button text="Save" type="button" id="saveAssessmentScoresBtn" disabled="true" onclick="saveAssessmentScores()" icon-type="Other" icon="fl fl-save" button-type="Light" />
                </div>
            </div>
        </div>
    </form>
}


